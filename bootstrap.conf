#! /bin/echo this-file-should-be-sourced,-not-executed.
## -*- Mode: shell-script -*-

## bootstrap -- bootstrapping script
##
## Time-stamp:      "2012-11-25 09:32:43 bkorb"
##
##  This file is part of Complexity.
##  Complexity Copyright (c) 2011 by Bruce Korb - all rights reserved
##
## Complexity is free software: you can redistribute it and/or modify it
## under the terms of the GNU General Public License as published by the
## Free Software Foundation, either version 3 of the License, or
## (at your option) any later version.
##
## Complexity is distributed in the hope that it will be useful, but
## WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
## See the GNU General Public License for more details.
##
## You should have received a copy of the GNU General Public License along
## with this program.  If not, see <http://www.gnu.org/licenses/>.

typeset -r prog=$(basename "$0" .sh)
typeset -r program=$(basename "$0")
typeset -r progdir=$(\cd $(dirname "$0") && pwd -P)
typeset -r progpid=$$

die()
{ 
    echo "${prog} error:  $*" >&2
    #kill -TERM ${progpid}
    #exit 1
}

initialize()
{
    set -e
    PS4='>BS-$FUNCNAME> '

    trap 'die "failed: $_"' 0
    builddir=$PWD
    mkdir m4 build-aux
    cd ${progdir}
    test -d .git && \
        git clean -f -x -d .
    chmod a+x tests/*.test

    cd src
    test -f opts.c -a -f opts.h -a opts.c -nt opts.def || \
        autogen opts.def

    test -f char-types.h -a char-types.h -nt char-types.map || \
        char-mapper char-types.map
    cd ..
    cp $(autoopts-config pkgdatadir)/liboptschk.m4 m4/.

    # Trick automake into "allowing" us to use texinfo rules:
    #
    printf '\\input texinfo\n@setfilename complexity.info\n' \
        > doc/complexity.texi

    build_aux=build-aux
    vc_ignore=.gitignore
    copy=true
    opt_force=true
    force=true
    AUTORECONF=$(command -v autoreconf)
    AUTOHEADER=$(command -v autoheader)
    gnulib_modules=$(echo       \
	close                   \
	fdl                     \
	gendocs                 \
	git-version-gen         \
	gpl-3.0                 \
	malloc-posix            \
	snprintf                \
	stdbool
    )
    set +e
}

initialize
